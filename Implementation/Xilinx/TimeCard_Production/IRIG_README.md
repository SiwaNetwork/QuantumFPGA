# IRIG Master - Генерация IRIG-B DCLS сигналов

## Обзор

В прошивку TimeCard_Production добавлен **IRIG Master IP** для генерации стандартных IRIG-B DCLS (Direct Current Level Shift) сигналов.

## Что такое IRIG-B?

**IRIG-B** - это стандартный протокол передачи временной информации, широко используемый в военных и промышленных системах синхронизации времени.

### Характеристики IRIG-B DCLS:
- **Скорость**: 100 бит/сек (10ms на бит)
- **Типы импульсов**:
  - **0**: 2ms высокий + 8ms низкий
  - **1**: 5ms высокий + 5ms низкий  
  - **P** (Position): 8ms высокий + 2ms низкий (маркер секунды)
- **Длина кадра**: 100 бит = 1 секунда
- **Синхронизация**: По 1PPS (положительный фронт)

## Конфигурация в прошивке

### Адрес IRIG Master:
- **Базовый адрес**: `0x01110000`
- **AXI4-Lite интерфейс**: Полная конфигурация и мониторинг

### Регистры:
- **Control (0x0000)**: Enable, Reset
- **Status (0x0004)**: Active, Sync, Error  
- **Config (0x0008)**: Polarity
- **Version (0x000C)**: Версия IP

### Выходные сигналы (по умолчанию):
- **SMA1**: По умолчанию (настраивается программно)
- **SMA3**: 10 МГц сигнал (через Signal Generator 1)

### Настройка IRIG на SMA:
```c
// Направить IRIG Master на SMA1
uint32_t sma_config = read_reg(0x00140020);
sma_config = (sma_config & 0xFFFFFFF0) | 0x00000010; // SMA1 = IRIG Master (0x8010)
write_reg(0x00140020, sma_config);
```

## Программное управление

IRIG Master **не включается автоматически** при старте. Для использования:

1. **Включить генерацию**: `write_reg(0x01110000, 0x00000001)`
2. **Настроить маршрутизацию SMA**: Направить IRIG Master на нужный SMA
3. **Мониторить статус**: Проверить Active/Sync/Error биты

## Использование

### Полное программное управление:
```c
// 1. Направить IRIG Master на SMA1
uint32_t sma_config = read_reg(0x00140020);
sma_config = (sma_config & 0xFFFFFFF0) | 0x00000010; // SMA1 = IRIG Master
write_reg(0x00140020, sma_config);

// 2. Включить IRIG Master
write_reg(0x01110000, 0x00000001);  // Enable

// 3. Проверить статус
uint32_t status = read_reg(0x01110004);
bool active = (status & 0x01) != 0;    // Active
bool sync = (status & 0x02) != 0;      // Sync with PPS
bool error = (status & 0x04) != 0;     // Error
```

### Мониторинг:
- **Active**: Генерация активна
- **Sync**: Синхронизация с PPS
- **Error**: Ошибка генерации

## Выходные сигналы

### SMA1 - IRIG-B DCLS:
- **Протокол**: IRIG-B (100 bps)
- **Синхронизация**: 1PPS
- **Содержимое**: Время, дата, контрольные биты

### SMA3 - 10 МГц:
- **Частота**: 10 МГц (PPS-locked)
- **Источник**: Signal Generator 1
- **Синхронизация**: 1PPS

## Совместимость

IRIG-B DCLS сигнал совместим с:
- Военными системами синхронизации
- Промышленными тайм-серверами
- Оборудованием с IRIG-B входом
- Системами мониторинга времени

## Техническая информация

### Требования:
- **PPS вход**: Обязателен для синхронизации
- **Точное время**: От Adjustable Clock
- **Системная тактовая**: 50 МГц (по умолчанию)

### Производительность:
- **Точность синхронизации**: ±1 μs (зависит от PPS)
- **Дрейф**: Минимальный (привязан к PPS)
- **Задержка**: < 10 μs

## Устранение неполадок

### IRIG Master не активен:
1. Проверить Enable бит в Control регистре
2. Убедиться в наличии PPS сигнала
3. Проверить статус Sync

### Ошибки синхронизации:
1. Проверить качество PPS сигнала
2. Убедиться в корректности времени
3. Проверить Status регистр на ошибки

### Отсутствие сигнала на SMA1:
1. Проверить маршрутизацию SMA Selector
2. Убедиться в активности IRIG Master
3. Проверить физическое подключение
