# Описание дизайна Clock Detector
## Содержание

[1. Обзор](#1-context-overview)

[2. Описание интерфейса](#2-interface-description)

[3. Набор регистров](#3-register-set)

[4. Описание дизайна](#4-design-description)

## 1. Обзор
Clock Detector — полностью аппаратная (FPGA) реализация для обнаружения доступных источников тактов и выбора используемых тактов. Выбор выполняется с помощью выходов селекторов тактов и сигналов enable, по схеме приоритетов с возможностью принудительной конфигурации. Конфигурация и мониторинг — через AXI4‑Lite.

## 2. Описание интерфейса
### 2.1 Clock Detector IP
Интерфейс:
- Входы системного сброса и системной тактовой
- 4 входа тактовых сигналов
- Выходы enable к внешним селекторам тактов
- Выход сброса на время переключения источника
- Выход выбранного источника PPS (сигнал конфигурации для [PPS Source Select](../PpsSourceSelector))
- Вход доступности источников PPS (мониторинг от [PPS Source Select](../PpsSourceSelector))
- Интерфейс AXI4‑Lite для конфигурации/мониторинга (и, опционально, внешнего [PPS Source Select](../PpsSourceSelector))

![Clock Detector IP](Additional%20Files/ClockDetectorIP.png)

Параметры конфигурации для выбора тактов и PPS:

![Clock Detector IP](Additional%20Files/ClockDetectorConfig.png)

## 3. Набор регистров
AXI4‑Lite; 32‑битные регистры; без burst/byte enable/таймаутов/невыравненных доступов; адресное пространство не непрерывно; вне диапазона — ошибка декодирования. Набор регистров настраивает источник тактов и мониторит выбранный источник. Также содержит конфигурацию для ядра [PPS Source Select](../PpsSourceSelector).

### 3.1 Обзор
![RegisterSet](Additional%20Files/Regset_Overview.png)

### 3.2 Описание регистров
![SourceSelected](Additional%20Files/Regset1_SourceSelected.png)
![SourceSelect](Additional%20Files/Regset2_SourceSelect.png)
![Version](Additional%20Files/Regset3_Version.png)

## 4. Описание дизайна
Clock Detector обнаруживает доступные входы тактов и выбирает используемые такты, исходя из приоритетов и конфигурации.

### 4.1 Обнаружение доступных тактов
Для каждого входа выполняется проверка доступности. Для каждого домена формируется «медленный» такт; в домене системной тактовой проверяется переключение значений этих сигналов. Если значение не меняется в течение таймаута — входной такт считается недоступным.

### 4.2 Выбор тактов
Такт выбирается при выполнении условий:
1) Такт доступен
2) 
   - Автовыбор: такт имеет более высокий приоритет среди доступных
   - Ручной выбор: такт имеет более высокий приоритет среди доступных и вручную выбранных

Таблица соответствия выходов селектора для приоритетов (от наивысшего к низшему: SMA 10 МГц → MAC 10 МГц → DCXO1 10 МГц → MAC 10 МГц (вторая ветвь) → Внешний):

|Clock|Mux1|Mux2|Mux3|Wiz2|
|-----|:--:|:--:|:--:|:--:|
|SMA 10 MHz Clock|0|x|0|0|
|MAC 10 MHz Clock|1|x|0|0|
|DCXO1 10 Mhz Clock|x|0|1|0|
|MAC 10 MHz Clock|x|1|1|0|
|External Clock|x|x|x|1|

### 4.3 AXI‑slave
AXI4‑Lite предоставляет доступ к регистрам ядра. CPU конфигурирует наборы через записи по AXI. Подробности — в [разделе 3](#3-register-set).
