# Описание дизайна IRIG Master
## Содержание

[1. Обзор](#1-context-overview)

[2. Описание интерфейса](#2-interface-description)

[3. Набор регистров](#3-register-set)

[4. Описание дизайна](#4-design-description)

## 1. Обзор
IRIG Master — полностью аппаратная (FPGA) реализация генератора IRIG-B DCLS (Direct Current Level Shift) сигналов. Генерирует стандартный IRIG-B временной код с синхронизацией по 1PPS и текущему времени от Adjustable Clock. Поддерживает конфигурацию через AXI4-Lite интерфейс.

## 2. Описание интерфейса
### 2.1 IRIG Master IP
Интерфейс:
- Входы системного сброса и системной тактовой
- Вход высокоточной тактовой (целое кратное системной)
- Вход локального времени от [Adjustable Clock](../AdjustableClock/Readme.md)
- Вход PPS для синхронизации генерации
- Выход IRIG-B DCLS сигнала
- Интерфейс AXI4-Lite для доступа к регистрам

![IRIG Master IP](Additional%20Files/IrigMaster_IP.png)

Параметры конфигурации:
- Период системной тактовой в нс
- Множитель частоты высокоточной тактовой

![IRIG Master Gui](Additional%20Files/IrigMaster_Config.png)

## 3. Набор регистров
Регистры доступны по AXI4-Lite. 32-битные, без burst/byte enable/таймаутов/невыравненных доступов; вне диапазона — ошибка декодирования.

### 3.1 Обзор
![RegisterSet](Additional%20Files/RegsetOverview.png)

### 3.2 Описание регистров

#### 3.2.1 Control Register (0x0000)
![Control](Additional%20Files/Regset1_Control.png)

| Бит | Имя | Описание |
|-----|-----|----------|
| 0 | Enable | Включить генерацию IRIG-B сигнала |
| 1 | Reset | Сброс генератора (автосброс) |
| 31:2 | Reserved | Зарезервировано |

#### 3.2.2 Status Register (0x0004)
![Status](Additional%20Files/Regset2_Status.png)

| Бит | Имя | Описание |
|-----|-----|----------|
| 0 | Active | Генерация активна |
| 1 | Sync | Синхронизация с PPS |
| 2 | Error | Ошибка генерации |
| 31:3 | Reserved | Зарезервировано |

#### 3.2.3 Config Register (0x0008)
![Config](Additional%20Files/Regset3_Config.png)

| Бит | Имя | Описание |
|-----|-----|----------|
| 0 | Polarity | Полярность выходного сигнала (0=инвертированная, 1=нормальная) |
| 31:1 | Reserved | Зарезервировано |

#### 3.2.4 Version Register (0x000C)
![Version](Additional%20Files/Regset4_Version.png)

| Поле | Описание |
|------|----------|
| 31:16 | Major Version |
| 15:0 | Minor Version |

## 4. Описание дизайна

### 4.1 IRIG-B DCLS Формат
IRIG Master генерирует стандартный IRIG-B DCLS сигнал:

- **Скорость**: 100 бит/сек (10ms на бит)
- **Типы импульсов**:
  - **0**: 2ms высокий + 8ms низкий
  - **1**: 5ms высокий + 5ms низкий  
  - **P** (Position): 8ms высокий + 2ms низкий (маркер секунды)
- **Длина кадра**: 100 бит = 1 секунда
- **Синхронизация**: По 1PPS (положительный фронт)

### 4.2 Алгоритм генерации
1. Ожидание PPS события
2. Генерация 100-битного кадра IRIG-B
3. Каждый бит генерируется с соответствующей шириной импульса
4. Повтор с следующего PPS

### 4.3 Временные данные
Генератор использует текущее время от Adjustable Clock для формирования IRIG-B данных:
- Секунды
- Минуты  
- Часы
- День года
- Год

### 4.4 Состояния генератора
- **Idle**: Ожидание включения
- **WaitPps**: Ожидание PPS для синхронизации
- **GenerateFrame**: Генерация кадра IRIG-B
- **GenerateBit**: Генерация отдельного бита
- **WaitBitPeriod**: Ожидание завершения периода бита

### 4.5 AXI-интерфейс
Ядро предоставляет стандартный AXI4-Lite slave интерфейс для:
- Конфигурации генератора
- Мониторинга статуса
- Чтения версии

### 4.6 Прерывания
- Генерация прерывания при ошибках
- Маскирование прерываний через конфигурацию
