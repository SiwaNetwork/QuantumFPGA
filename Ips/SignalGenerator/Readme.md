# Описание дизайна Signal Generator
## Содержание

[1. Обзор](#1-context-overview)

[2. Описание интерфейса](#2-interface-description)

[3. Набор регистров](#3-register-set)

[4. Описание дизайна](#4-design-description)

## 1. Обзор
Signal Generator — полностью аппаратная (FPGA) реализация генератора PWM‑сигналов с настраиваемой полярностью, выравненных по локальным часам. Принимает время старта, длительность импульса и период, а также число повторов, и формирует сигнал соответственно. Настройки выполняются через AXI4‑Lite.

## 2. Описание интерфейса
### 2.1 Signal Generator IP
Интерфейс:
- Входы системного сброса и системной тактовой
- Вход высокоточной тактовой (целое кратное системной, фиксированная связь)
- Вход локального времени от [Adjustable Clock](../AdjustableClock/Readme.md)
- Интерфейс AXI4‑Lite для доступа к регистрам генератора
- Необязательный выход прерывания при остановке генерации из‑за ошибки времени

![Signal Generator IP](Additional%20Files/SigGeneratorIP.png)

Параметры конфигурации:
- Период системной тактовой в нс
- Множитель частоты высокоточной тактовой
- Включение/отключение компенсации задержки кабеля (значение по AXI в нс)
- Компенсируемая выходная задержка в нс
- Полярность генерируемого сигнала

![Signal Generator Gui](Additional%20Files/SigGeneratorConfiguration.png)

## 3. Набор регистров
Регистры доступны по AXI4‑Lite. 32‑битные, без burst/byte enable/таймаутов/невыравненных доступов; вне диапазона — ошибка декодирования.

### 3.1 Обзор
![RegisterSet](Additional%20Files/RegsetOverview.png)

### 3.2 Описание регистров
![Control](Additional%20Files/Regset1_Control.png)
![Status](Additional%20Files/Regset2_Status.png)
![Polarity](Additional%20Files/Regset3_Polarity.png)
![Version](Additional%20Files/Regset4_Version.png)
![Cable](Additional%20Files/Regset5_Cable.png)
![IRQ](Additional%20Files/Regset6_Irq.png)
![MSK](Additional%20Files/Regset7_Msk.png)
![Start_L](Additional%20Files/Regset8_StartL.png)
![Start_H](Additional%20Files/Regset9_StartH.png)
![PulseL](Additional%20Files/Regset10_PulseL.png)
![PulseH](Additional%20Files/Regset11_PulseH.png)
![PeriodL](Additional%20Files/Regset12_PeriodL.png)
![PeriodH](Additional%20Files/Regset13_PeriodH.png)
![Repeat](Additional%20Files/Regset14_Repeat.png)

## 4. Описание дизайна
Генератор принимает (синхронизированное) время и формирует PWM‑сигнал, выравненный по локальному времени, компенсируя выходную задержку. Содержит AXI4‑Lite для конфигурации и статуса.
Состоит из 3 операций:
- Периодическая генерация сигнала, выровненная по локальному времени
- Точная подстройка фронтов высокоточной тактовой
- Интерфейс с CPU через AXI‑slave

### 4.1 Периодическая генерация
Требуются: время старта, длительность импульса, период и счётчик повторений (0 — непрерывно). При включении и установке параметров вычисляются времена начала/окончания импульса с учётом задержки выхода. При достижении времени старта устанавливается активный уровень в соответствии с полярностью; затем время старта/останова сдвигается на период. По окончании длительности устанавливается пассивный уровень; счётчик импульсов инкрементируется. При скачке времени генерация сразу отключается, выход — в пассивное состояние полярности. Время старта должно быть в будущем.

### 4.2 Вычисление точного времени
Помимо компенсации выходной/кабельной задержек, фронты формируются высокоточной тактовой (кратной системной). Разница между текущим временем и временем старта/останова определяет количество периодов высокоточной тактовой до формирования фронта.

### 4.3 AXI‑slave
AXI4‑Lite предоставляет доступ к конфигурации/статусу; CPU настраивает наборы регистров. Подробнее — в [разделе 3](#3-register-set).
